import{_ as a,c as i,o as t,ae as l}from"./chunks/framework.DUP9kEI5.js";const c=JSON.parse('{"title":"","description":"","frontmatter":{},"headers":[],"relativePath":"guide/video-to-chatml.md","filePath":"guide/video-to-chatml.md"}'),e={name:"guide/video-to-chatml.md"};function n(h,s,p,d,o,r){return t(),i("div",null,s[0]||(s[0]=[l(`<h2 id="video-to-chatml-视频对话转换" tabindex="-1">Video-to-ChatML 视频对话转换 <a class="header-anchor" href="#video-to-chatml-视频对话转换" aria-label="Permalink to &quot;Video-to-ChatML 视频对话转换&quot;">​</a></h2><blockquote><p>将包含双音轨对话的视频文件转换为ChatML格式的训练数据 适用于从录制的对话视频中提取聊天数据进行模型训练</p></blockquote><h2 id="功能简介" tabindex="-1">功能简介 <a class="header-anchor" href="#功能简介" aria-label="Permalink to &quot;功能简介&quot;">​</a></h2><p>Video-to-ChatML 是一个强大的工具，可以将包含双音轨对话的视频文件转换为ChatML格式的训练数据。这个功能特别适用于：</p><ul><li>从录制的对话视频中提取聊天数据</li><li>将语音对话转换为文本格式</li><li>生成可用于模型微调的ChatML格式数据</li><li>支持多种语言的语音识别</li></ul><h2 id="环境要求" tabindex="-1">环境要求 <a class="header-anchor" href="#环境要求" aria-label="Permalink to &quot;环境要求&quot;">​</a></h2><h3 id="系统要求" tabindex="-1">系统要求 <a class="header-anchor" href="#系统要求" aria-label="Permalink to &quot;系统要求&quot;">​</a></h3><ul><li>Python 3.7+</li><li>FFmpeg (用于音频处理)</li><li>CUDA (可选，用于GPU加速)</li></ul><h3 id="依赖安装" tabindex="-1">依赖安装 <a class="header-anchor" href="#依赖安装" aria-label="Permalink to &quot;依赖安装&quot;">​</a></h3><p>进入 <code>video-to-chatml</code> 目录：</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">cd</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> video-to-chatml</span></span></code></pre></div><p>安装Python依赖：</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">pip</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> install</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -r</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> requirements.txt</span></span></code></pre></div><h3 id="ffmpeg-安装" tabindex="-1">FFmpeg 安装 <a class="header-anchor" href="#ffmpeg-安装" aria-label="Permalink to &quot;FFmpeg 安装&quot;">​</a></h3><p><strong>Windows:</strong></p><ol><li>下载 FFmpeg: <a href="https://ffmpeg.org/download.html" target="_blank" rel="noreferrer">https://ffmpeg.org/download.html</a></li><li>解压到任意目录</li><li>将 FFmpeg 的 bin 目录添加到系统 PATH</li></ol><p><strong>Linux/Mac:</strong></p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Ubuntu/Debian</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> apt</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> update</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> &amp;&amp; </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> apt</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> install</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ffmpeg</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># macOS (使用 Homebrew)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">brew</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> install</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ffmpeg</span></span></code></pre></div><h2 id="使用方法" tabindex="-1">使用方法 <a class="header-anchor" href="#使用方法" aria-label="Permalink to &quot;使用方法&quot;">​</a></h2><h3 id="方法一-使用启动脚本-推荐" tabindex="-1">方法一：使用启动脚本（推荐） <a class="header-anchor" href="#方法一-使用启动脚本-推荐" aria-label="Permalink to &quot;方法一：使用启动脚本（推荐）&quot;">​</a></h3><p>运行启动脚本，它会自动检查依赖并引导你完成配置：</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">python</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> start-vtc.py</span></span></code></pre></div><p>启动脚本会：</p><ol><li>自动检查所有依赖项</li><li>提供交互式配置界面</li><li>自动检测视频的音轨信息</li><li>引导你选择正确的音轨配置</li></ol><h3 id="方法二-直接使用转换脚本" tabindex="-1">方法二：直接使用转换脚本 <a class="header-anchor" href="#方法二-直接使用转换脚本" aria-label="Permalink to &quot;方法二：直接使用转换脚本&quot;">​</a></h3><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">python</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> video-to-chatml.py</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [选项] 视频文件路径</span></span></code></pre></div><h4 id="基本参数" tabindex="-1">基本参数 <a class="header-anchor" href="#基本参数" aria-label="Permalink to &quot;基本参数&quot;">​</a></h4><ul><li><code>video_path</code>: 输入视频文件路径</li><li><code>--user-track</code>: 用户音轨索引 (默认: 0)</li><li><code>--assistant-track</code>: 助手音轨索引 (默认: 1)</li><li><code>--output</code>: 输出ChatML文件路径 (默认: output.jsonl)</li><li><code>--model</code>: Whisper模型名称 (默认: base)</li><li><code>--language</code>: 指定语言 (可选，如: zh, en)</li></ul><h4 id="使用示例" tabindex="-1">使用示例 <a class="header-anchor" href="#使用示例" aria-label="Permalink to &quot;使用示例&quot;">​</a></h4><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 基本使用</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">python</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> video-to-chatml.py</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> conversation.mp4</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 指定音轨和输出文件</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">python</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> video-to-chatml.py</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> conversation.mp4</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --user-track</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --assistant-track</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --output</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> chat_data.jsonl</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 使用更大的Whisper模型提高准确性</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">python</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> video-to-chatml.py</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> conversation.mp4</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --model</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> large</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --language</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> zh</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 完整参数示例</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">python</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> video-to-chatml.py</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> conversation.mp4</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  --user-track</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  --assistant-track</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  --output</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> training_data.jsonl</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  --model</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> medium</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  --language</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> zh</span></span></code></pre></div><h2 id="whisper-模型选择" tabindex="-1">Whisper 模型选择 <a class="header-anchor" href="#whisper-模型选择" aria-label="Permalink to &quot;Whisper 模型选择&quot;">​</a></h2><table tabindex="0"><thead><tr><th>模型名称</th><th>参数量</th><th>英语准确性</th><th>多语言准确性</th><th>速度</th><th>显存需求</th></tr></thead><tbody><tr><td>tiny</td><td>39M</td><td>较低</td><td>较低</td><td>最快</td><td>~1GB</td></tr><tr><td>base</td><td>74M</td><td>中等</td><td>中等</td><td>快</td><td>~1GB</td></tr><tr><td>small</td><td>244M</td><td>良好</td><td>良好</td><td>中等</td><td>~2GB</td></tr><tr><td>medium</td><td>769M</td><td>很好</td><td>很好</td><td>较慢</td><td>~5GB</td></tr><tr><td>large</td><td>1550M</td><td>最好</td><td>最好</td><td>最慢</td><td>~10GB</td></tr></tbody></table><p><strong>推荐选择：</strong></p><ul><li>快速测试：<code>base</code></li><li>平衡性能：<code>small</code> 或 <code>medium</code></li><li>最高质量：<code>large</code></li></ul><h2 id="视频格式要求" tabindex="-1">视频格式要求 <a class="header-anchor" href="#视频格式要求" aria-label="Permalink to &quot;视频格式要求&quot;">​</a></h2><h3 id="音轨配置" tabindex="-1">音轨配置 <a class="header-anchor" href="#音轨配置" aria-label="Permalink to &quot;音轨配置&quot;">​</a></h3><p>视频文件需要包含<strong>两个独立的音轨</strong>：</p><ul><li>音轨 0：用户语音</li><li>音轨 1：助手语音</li></ul><h3 id="支持的视频格式" tabindex="-1">支持的视频格式 <a class="header-anchor" href="#支持的视频格式" aria-label="Permalink to &quot;支持的视频格式&quot;">​</a></h3><ul><li>MP4 (推荐)</li><li>AVI</li><li>MOV</li><li>MKV</li><li>其他FFmpeg支持的格式</li></ul><h3 id="音频要求" tabindex="-1">音频要求 <a class="header-anchor" href="#音频要求" aria-label="Permalink to &quot;音频要求&quot;">​</a></h3><ul><li>采样率：建议 16kHz 或更高</li><li>声道：单声道或立体声</li><li>编码：任何FFmpeg支持的音频编码</li></ul><h2 id="输出格式" tabindex="-1">输出格式 <a class="header-anchor" href="#输出格式" aria-label="Permalink to &quot;输出格式&quot;">​</a></h2><p>转换后的数据将保存为ChatML格式的JSONL文件，每行包含一个对话：</p><div class="language-json vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;messages&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: [</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">      &quot;role&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;user&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">      &quot;content&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;你好，今天天气怎么样？&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">      &quot;role&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;assistant&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">      &quot;content&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;今天天气很不错，阳光明媚，温度适宜。&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  ]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><h2 id="高级配置" tabindex="-1">高级配置 <a class="header-anchor" href="#高级配置" aria-label="Permalink to &quot;高级配置&quot;">​</a></h2><h3 id="语言设置" tabindex="-1">语言设置 <a class="header-anchor" href="#语言设置" aria-label="Permalink to &quot;语言设置&quot;">​</a></h3><p>支持的语言代码（部分）：</p><ul><li><code>zh</code>: 中文</li><li><code>en</code>: 英语</li><li><code>ja</code>: 日语</li><li><code>ko</code>: 韩语</li><li><code>fr</code>: 法语</li><li><code>de</code>: 德语</li><li><code>es</code>: 西班牙语</li></ul><h3 id="性能优化" tabindex="-1">性能优化 <a class="header-anchor" href="#性能优化" aria-label="Permalink to &quot;性能优化&quot;">​</a></h3><ol><li><strong>GPU加速</strong>：确保安装了CUDA版本的PyTorch</li><li><strong>模型选择</strong>：根据硬件配置选择合适的Whisper模型</li><li><strong>批处理</strong>：对于大量视频文件，可以编写脚本批量处理</li></ol><h2 id="故障排除" tabindex="-1">故障排除 <a class="header-anchor" href="#故障排除" aria-label="Permalink to &quot;故障排除&quot;">​</a></h2><h3 id="常见问题" tabindex="-1">常见问题 <a class="header-anchor" href="#常见问题" aria-label="Permalink to &quot;常见问题&quot;">​</a></h3><p><strong>1. FFmpeg 未找到</strong></p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>错误: ffmpeg 未找到，请安装 ffmpeg</span></span></code></pre></div><p>解决方案：确保FFmpeg已正确安装并添加到系统PATH</p><p><strong>2. 音轨提取失败</strong></p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>错误: 提取音轨失败</span></span></code></pre></div><p>解决方案：</p><ul><li>检查视频文件是否包含指定的音轨</li><li>使用 <code>ffprobe</code> 命令查看视频的音轨信息：<div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ffprobe</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -v</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> quiet</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -print_format</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> json</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -show_streams</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> input.mp4</span></span></code></pre></div></li></ul><p><strong>3. 显存不足</strong></p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>错误: CUDA out of memory</span></span></code></pre></div><p>解决方案：</p><ul><li>使用更小的Whisper模型（如 <code>base</code> 或 <code>small</code>）</li><li>在CPU上运行（会较慢但不需要显存）</li></ul><p><strong>4. 识别准确性低</strong> 解决方案：</p><ul><li>使用更大的Whisper模型</li><li>确保音频质量良好</li><li>指定正确的语言参数</li></ul><h3 id="调试模式" tabindex="-1">调试模式 <a class="header-anchor" href="#调试模式" aria-label="Permalink to &quot;调试模式&quot;">​</a></h3><p>如果遇到问题，可以查看详细的错误信息：</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">python</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> video-to-chatml.py</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> conversation.mp4</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --verbose</span></span></code></pre></div><h2 id="最佳实践" tabindex="-1">最佳实践 <a class="header-anchor" href="#最佳实践" aria-label="Permalink to &quot;最佳实践&quot;">​</a></h2><ol><li><strong>音频质量</strong>：确保录制的音频清晰，背景噪音较少</li><li><strong>音轨分离</strong>：录制时确保用户和助手的声音在不同的音轨上</li><li><strong>语言一致性</strong>：指定正确的语言参数以提高识别准确性</li><li><strong>模型选择</strong>：根据硬件配置和质量要求选择合适的Whisper模型</li><li><strong>数据验证</strong>：转换完成后检查输出数据的质量和格式</li></ol><h2 id="与其他功能的集成" tabindex="-1">与其他功能的集成 <a class="header-anchor" href="#与其他功能的集成" aria-label="Permalink to &quot;与其他功能的集成&quot;">​</a></h2><p>转换得到的ChatML数据可以直接用于：</p><ol><li><strong>数据混合</strong>：与其他数据源混合 → <a href="./mix-data.html">混合数据</a></li><li><strong>模型微调</strong>：用于微调大语言模型 → <a href="./fine-tune-model.html">微调模型</a></li><li><strong>数据清洗</strong>：进一步清洗和优化 → <a href="./clean-data.html">清洗数据</a></li></ol><hr><p><strong>提示</strong>：Video-to-ChatML 功能为数字分身项目提供了从多媒体内容中获取训练数据的能力，让你可以利用更多样化的数据源来训练个性化的AI模型。</p>`,76)]))}const g=a(e,[["render",n]]);export{c as __pageData,g as default};
